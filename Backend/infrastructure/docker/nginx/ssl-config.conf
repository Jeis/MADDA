# Enterprise SSL Configuration for Spatial Platform
# Production-ready SSL/TLS configuration following PROJECT_STANDARDS.md requirements
# 
# This configuration provides:
# - Enterprise-grade security with modern TLS protocols
# - Environment-aware certificate management
# - Performance optimization with session caching
# - Security headers for comprehensive protection
# - OCSP stapling capability for production environments

# Performance optimizations - These directives are not duplicated
ssl_buffer_size 8k;               # Optimize buffer size for performance  
ssl_early_data on;                # Enable 0-RTT for TLS 1.3

# Additional SSL configuration that doesn't conflict with main nginx.conf

# Environment-aware certificate mapping
# Development Environment - Single wildcard certificate
map $host $ssl_certificate_dev {
    default                  "/etc/nginx/ssl/localhost.crt";
    localhost               "/etc/nginx/ssl/localhost.crt";  
    monitoring.localhost    "/etc/nginx/ssl/localhost.crt";
    admin.localhost        "/etc/nginx/ssl/localhost.crt";
}

map $host $ssl_certificate_key_dev {
    default                  "/etc/nginx/ssl/localhost.key";
    localhost               "/etc/nginx/ssl/localhost.key";
    monitoring.localhost    "/etc/nginx/ssl/localhost.key"; 
    admin.localhost        "/etc/nginx/ssl/localhost.key";
}

# Production Environment - Domain-specific certificates
# In production, each service should have its own certificate
map $host $ssl_certificate_prod {
    default                     "/etc/nginx/ssl/main.crt";
    ~^monitoring\.(.+)$         "/etc/nginx/ssl/monitoring.$1.crt";
    ~^admin\.(.+)$              "/etc/nginx/ssl/admin.$1.crt";
    ~^(.+)$                     "/etc/nginx/ssl/$1.crt";
}

map $host $ssl_certificate_key_prod {
    default                     "/etc/nginx/ssl/main.key";
    ~^monitoring\.(.+)$         "/etc/nginx/ssl/monitoring.$1.key"; 
    ~^admin\.(.+)$              "/etc/nginx/ssl/admin.$1.key";
    ~^(.+)$                     "/etc/nginx/ssl/$1.key";
}

# Certificate validation settings for mutual TLS (optional)
ssl_verify_client optional_no_ca;