# Dual Endpoint Strategy for Open Source - Following PROJECT_STANDARDS.md

# Production health checks - no logging (Docker/K8s)
location = /healthz {
    access_log off;
    return 200 '{"status":"healthy","service":"nginx","timestamp":"'$(date -u '+%Y-%m-%dT%H:%M:%SZ')'","endpoint":"healthz"}';
    add_header Content-Type application/json;
}

# Debug health checks - full logging (contributors/operators)  
location = /health {
    access_log /var/log/nginx/health.log;
    return 200 '{"status":"healthy","service":"nginx","timestamp":"'$(date -u '+%Y-%m-%dT%H:%M:%SZ')'","endpoint":"health","logging":"enabled"}';
    add_header Content-Type application/json;
}

# Advanced monitoring - error-only logging
map $status $healthz_error_log {
    ~^[45]  1;  # Log 4xx, 5xx errors only
    default 0;  # Don't log success responses
}

location = /healthz-debug {
    access_log /var/log/nginx/health_errors.log if=$healthz_error_log;
    return 200 '{"status":"healthy","service":"nginx","timestamp":"'$(date -u '+%Y-%m-%dT%H:%M:%SZ')'","endpoint":"healthz-debug","logging":"error_only"}';
    add_header Content-Type application/json;
}
